<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <title>Firebase Auth ãƒ†ã‚¹ãƒˆ</title>
  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-auth-compat.js"></script>
</head>
<body>
  <h1>Firebase èªè¨¼ãƒ†ã‚¹ãƒˆ</h1>
  <button id="callFunction">Cloud Function å‘¼ã³å‡ºã—</button>

  <pre id="log"></pre>

  <script>


    // Firebaseãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆè¨­å®š
    const firebaseConfig = {
      apiKey: "AIzaSyBImwBMbP_4rbm-dsB2R8dhtlblA9HTBS8",
      authDomain: "coco-auction.firebaseapp.com",
      projectId: "coco-auction",
      storageBucket: "coco-auction.appspot.com",
      messagingSenderId: "12632824391",
      appId: "1:12632824391:web:ab6e784ba311de069eef62"
    };





    // âœ… Firebase åˆæœŸåŒ–
    firebase.initializeApp(firebaseConfig);

    const log = (...args) => {
      const logEl = document.getElementById("log");
      logEl.textContent += args.join(" ") + "\n";
      console.log(...args);
    };

    // ğŸ” åŒ¿åãƒ­ã‚°ã‚¤ãƒ³
    firebase.auth().signInAnonymously()
      .then(cred => {
        log("âœ… FirebaseåŒ¿åãƒ­ã‚°ã‚¤ãƒ³å®Œäº†ï¼UID:", cred.user.uid);
      })
      .catch(error => {
        log("âŒ FirebaseåŒ¿åãƒ­ã‚°ã‚¤ãƒ³å¤±æ•—:", error);
      });

    // ğŸ“¡ Cloud Function å‘¼ã³å‡ºã—
    document.getElementById("callFunction").addEventListener("click", async () => {
      log("ğŸš€ Cloud Functionå‘¼ã³å‡ºã—é–‹å§‹...");

      const user = firebase.auth().currentUser;
      if (!user) return log("âŒ èªè¨¼ã•ã‚Œã¦ã„ã¾ã›ã‚“");

      const idToken = await user.getIdToken(true); // ğŸ” å¼·åˆ¶ãƒªãƒ•ãƒ¬ãƒƒã‚·ãƒ¥
      log("ğŸªª IDãƒˆãƒ¼ã‚¯ãƒ³å–å¾—:", idToken.slice(0, 20) + "...");

      // ğŸŒ Cloud Function ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆ
      const endpoint = "https://us-central1-coco-auction.cloudfunctions.net/testAuthFunction";

      try {
        const res = await fetch(endpoint, {
          method: "POST",
          headers: {
            "Content-Type": "application/json",
            "Authorization": `Bearer ${idToken}`,
          },
          body: JSON.stringify({ message: "Hello from frontend" })
        });

        const json = await res.json();
        log("âœ… Cloud Function å¿œç­”:", JSON.stringify(json));
      } catch (err) {
        log("âŒ Cloud Function ã‚¨ãƒ©ãƒ¼:", err);
      }
    });
  </script>
</body>
</html>






