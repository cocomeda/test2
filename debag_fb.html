<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Firebase Storage 画像アップロード</title>
</head>
<body>
    <h1>Firebase Storage 画像アップロード</h1>
    
    <input type="file" id="image-upload-input" accept="image/*">
    <button id="upload-button">画像をアップロード</button>

    <div id="message"></div>
    <div id="image-preview">
        <img id="uploaded-image" style="max-width: 300px; display: none;">
    </div>

    <script src="https://www.gstatic.com/firebasejs/9.6.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.0/firebase-storage-compat.js"></script>

    <script>
        // Firebase Configuration (YOUR_XXXXを実際のプロジェクト情報に置き換えてください)
        const firebaseConfig = {
            apiKey: "YOUR_API_KEY",
            authDomain: "YOUR_AUTH_DOMAIN",
            projectId: "YOUR_PROJECT_ID",
            storageBucket: "YOUR_STORAGE_BUCKET",
            messagingSenderId: "YOUR_MESSAGING_SENDER_ID",
            appId: "YOUR_APP_ID"
        };

        // Firebaseの初期化
        firebase.initializeApp(firebaseConfig);
        const storage = firebase.storage();
        
        const fileInput = document.getElementById('image-upload-input');
        const uploadButton = document.getElementById('upload-button');
        const messageDiv = document.getElementById('message');
        const uploadedImage = document.getElementById('uploaded-image');

        // メッセージ表示関数
        function showMessage(text, color) {
            messageDiv.textContent = text;
            messageDiv.style.color = color;
        }

        // 画像をアップロードする関数
        async function uploadImage() {
            const file = fileInput.files[0];

            if (!file) {
                showMessage("ファイルを選択してください。", "red");
                return;
            }

            showMessage("アップロード中...", "blue");
            uploadButton.disabled = true;

            try {
                // Storageの参照を作成（例: 'images/ユニークなファイル名.jpg'）
                const timestamp = Date.now();
                const fileName = `images/${timestamp}_${file.name}`;
                const storageRef = storage.ref().child(fileName);

                // ファイルをアップロード
                const snapshot = await storageRef.put(file);

                // ダウンロードURLを取得
                const downloadURL = await snapshot.ref.getDownloadURL();
                
                showMessage("アップロードが完了しました！", "green");
                console.log("ダウンロードURL:", downloadURL);

                // 画像をプレビューに表示
                uploadedImage.src = downloadURL;
                uploadedImage.style.display = 'block';

            } catch (error) {
                showMessage(`アップロードに失敗しました: ${error.message}`, "red");
                console.error("アップロードエラー:", error);
            } finally {
                uploadButton.disabled = false;
            }
        }

        // ボタンにクリックイベントを設定
        uploadButton.addEventListener('click', uploadImage);
    </script>
</body>
</html>
