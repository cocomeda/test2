



<!DOCTYPE html>





<html lang="ja">





<head>





<meta charset="UTF-8">





<meta name="viewport" content="width=device-width, initial-scale=1.0">





<title>タブインターフェース (デザイン改善)</title>



<style>



html, body {



height: 100%;







margin: 0;



padding: 0;



overflow: hidden; /* 全体スクロールを無効にする */ }







body {



font-family: Arial, sans-serif;



display: flex;



justify-content: center;



align-items: center;



background-color: #f0f2f5;



}







.tab-container {



width: 100%; /* ビューポートの全幅を使用 */



height: 100vh; /* ビューポートの全高を使用 */



max-width: none; /* 最大幅の制限を解除 */



background-color: #fff;



border-radius: 0; /* 角丸をなくす */



box-shadow: none; /* 影をなくす */



display: flex;



flex-direction: column;



overflow: hidden; /* コンテナ自体はスクロールしない */



}







.tab-buttons-wrapper {



display: flex;



flex-wrap: wrap;



justify-content: flex-start;



align-items: flex-end;



padding: 5px;



background-color: #f8f8f8;



border-bottom: 1px solid #dcdcdc;



box-sizing: border-box;



}







.tab-button {



flex: 1 1 50%; /* 2列固定：1つのボタンが50%を占めるように柔軟に */



max-width: 50%; /* 念のため最大幅も50% */



box-sizing: border-box;



margin-bottom: 5px;



padding: 12px 15px;



font-size: 15px;



font-weight: bold;



background-color: #e9e9e9;



border: 1px solid #dcdcdc;



border-bottom: none;



border-radius: 8px 8px 0 0;



color: #666;



cursor: pointer;



transition: all 0.3s ease;



white-space: nowrap;



text-align: center;



}







/* タブの間の右マージンを追加（2列目の右マージンは削除） */



.tab-button:nth-child(odd) {



padding-right: 10px; /* 奇数番目のタブに右パディング */



}



.tab-button:nth-child(even) {



padding-left: 10px; /* 偶数番目のタブに左パディング */



}







.tab-button:last-of-type {



margin-right: 0;



}







/* ホバー時のスタイル */



.tab-button:hover:not(.active) {



background-color: #dcdcdc;



color: #333;



border-color: #c0c0c0;



}







/* アクティブなタブのスタイル */



.tab-button.active {



background-color: #ffffff;



color: #007bff;



border: 1px solid #007bff;



border-bottom: 1px solid #ffffff;



z-index: 2;



}







.tab-content-container {



padding: 20px;



flex-grow: 1; /* 残りのスペースをすべて占める */



display: flex;



flex-direction: column;



overflow-y: auto; /* コンテンツがはみ出したらスクロール */



}







.tab-content {



display: none;



padding: 15px;



animation: fadeIn 0.5s ease-in-out;



flex-grow: 1;



}







.tab-content.active {



display: flex;



flex-direction: column;



}







/* フェードインアニメーション */



@keyframes fadeIn {



from {



opacity: 0;



transform: translateY(10px);



}



to {



opacity: 1;



transform: translateY(0);



}



}







/* メダカ品種チェック固有のスタイル */



.medaka-check .item {



display: flex;



align-items: center;



margin-bottom: 8px;



}



.medaka-check .item input[type="checkbox"] {



margin-right: 10px;



transform: scale(1.2);



}



.medaka-check .loading {



color: gray;



}



.medaka-check .error {



color: red;



}



.medaka-check button {



margin-top: 20px;



padding: 10px 20px;



background-color: #007bff;



color: white;



border: none;



border-radius: 5px;



cursor: pointer;



font-size: 16px;



transition: background-color 0.3s ease;



}



.medaka-check button:hover {



background-color: #0056b3;



}







/* レスポンシブデザイン */



@media (max-width: 768px) {



.tab-buttons-wrapper {



padding: 5px;



}



.tab-button {



flex-basis: calc(50% - 5px);



margin-right: 5px;



margin-bottom: 5px;



}



.tab-button:nth-child(2n) {



margin-right: 0;



}



.tab-button:last-of-type {



margin-right: 0;



}



.tab-content-container {



padding: 15px;



}



}







@media (max-width: 480px) {



.tab-button {



flex-basis: 100%; /* 1列表示 */



margin-right: 0;



margin-bottom: 5px;



}



}







/* QRコード生成とローカルタイルビューワーのスタイル調整 */



.modal {



display: none;



position: fixed;



z-index: 1;



left: 0;



top: 0;



width: 100%;



height: 100%;



overflow: auto;



background-color: rgba(0,0,0,0.4);



justify-content: center;



align-items: center;



}



.modal-content {



background-color: #fefefe;



margin: auto;



padding: 6vw;



border: 0.2vw solid #888;



border-radius: 2vw;



width: 80%;



max-width: 90vw; /* モーダルの最大幅を調整 */



box-shadow: 0 1vw 3vw rgba(0,0,0,0.3);



text-align: center;



position: relative;



}



.close-button {



color: #aaa;



float: right;



font-size: 5.6vw;



font-weight: bold;



position: absolute;



top: 2vw;



right: 4vw;



}



.close-button:hover,



.close-button:focus {



color: black;



text-decoration: none;



cursor: pointer;



}



.modal-title {



font-size: 3.6vw;



color: #333;



margin-bottom: 3vw;



}



.modal-body {



font-size: 2.4vw;



color: #555;



line-height: 1.6;



}























</style>





</head>





<body>





<div class="tab-container">





<div class="tab-buttons-wrapper">





<button class="tab-button active" data-tab="tab1">今日のメダカ</button>





<button class="tab-button" data-tab="tab2">予約確認</button>





<button class="tab-button" data-tab="tab3">問い合わせ</button>





<button class="tab-button" data-tab="tab4">新商品</button>





<button class="tab-button" data-tab="tab5">特殊QRコード</button>





<button class="tab-button" data-tab="tab6">QRコード生成</button>





</div>











<div class="tab-content-container">





<div id="tab1" class="tab-content active medaka-check">





<h2>今日のメダカ品種チェック</h2>







<div id="dataContainer"></div>



<p id="status" class="loading">データを読み込み中...</p>





<button id="submitButton">更新</button>





</div>











<div id="tab2" class="tab-content">





<h2>予約確認</h2>





<p>お客様の予約状況をご確認いただけます。ご予約番号を入力してください。</p>





<p>Lorem ipsum dolor sit amet, consectetur adipiscing elit. Sed do eiusmod tempor incididunt ut labore et dolore magna aliqua. Ut enim ad minim veniam, quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea commodo consequat. Duis aute irure dolor in reprehenderit in voluptate velit esse cillum dolore eu fugiat nulla pariatur. Excepteur sint occaecat cupidatat non proident, sunt in culpa qui officia deserunt mollit anim id est laborum.</p>





</div>





<div id="tab3" class="tab-content">





<h2>お問い合わせ</h2>





<p>ご不明な点がありましたら、こちらからお問い合わせください。</p>





<p>Lorem ipsum dolor sit amet, consectetur adipiscing elit. Sed do eiusmod tempor incididunt ut labore et dolore magna aliqua. Ut enim ad minim veniam, quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea commodo consequat. Duis aute irure dolor in reprehenderit in voluptate velit esse cillum dolore eu fugiat nulla pariatur. Excepteur sint occaecat cupidatat non proident, sunt in culpa qui officia deserunt mollit anim id est laborum.</p>





</div>





<div id="tab4" class="tab-content">





<h2>新商品情報</h2>





<p>新しいメダカや関連商品をご紹介します！</p>





<p>最新の情報をチェックしてください。</p>





</div>





<div id="tab5" class="tab-content">









<!DOCTYPE html>

<html lang="ja">

<head>

  <meta charset="UTF-8" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>

  <title>ローカルタイルビューワー</title>

  <script src="https://cdn.jsdelivr.net/npm/qrcode/build/qrcode.min.js"></script>





  <style>









    body {

      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;



      background-color: #f0f2f5;

      display: flex;

      flex-direction: column;

      align-items: center;







    }









    .container {

      width: 100vw;

      max-width: 100vw;

      background-color: #ffffff;

    

      border-radius: 10px;

      box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);

    }



    h1 {

      color: #333;

      text-align: center;

      margin-bottom: 30px;

    }



    .tile-grid {

      display: grid;

      grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));

      gap: 20px;

      padding: 10px;

      text-align: left;



    }



    .tile {

      background-color: #e0f7fa;

      border: 1px solid #b2ebf2;

      border-radius: 8px;

      padding: 15px;

      box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);

      transition: transform 0.2s ease, box-shadow 0.2s ease;

      position: relative;

      display: flex;

      flex-direction: column;

      justify-content: space-between;

      min-height: 2vw;

      cursor: pointer; /* タイルがクリック可能であることを示す */

    }



    .tile:hover {

      transform: translateY(-5px);

      box-shadow: 0 6px 12px rgba(0, 0, 0, 0.15);

      background-color: #b2ebf2;

    }



    .tile-info {

      color: #333;

      word-break: break-word;

      padding-top: 5px;

    }



    .tile-info p {

      margin: 0.2vw 0;

  margin-left: 0.4em;

    }



    .tile-info .main-text {

      font-size: 1.2em;

      color: #004d40;

      font-weight: bold;

   margin: 0vw  0 0.3em 0.2em;

    

    }



    .tile-description-box {

      margin-top: 10px;

  

      padding: 8px;

      border: 1px solid #ccc;

      border-radius: 6px;

      background-color: #ffffff;

      font-size: 0.8em;

      color: #444;

      white-space: pre-wrap;

      min-height: 6.6em;

      max-height: 6.9em;

      overflow: hidden;



    }



.tile-qrcode {

  position: absolute;

  top: 50%;

  right: 20px;

  transform: translateY(-50%);

  width: 5em;

  height: 5em;

  border: 1px solid #eee;

  background-color: #fff;

  padding: 2px;

  display: flex;

  align-items: center;

  justify-content: center;

}



    /* モーダル */

    .modal {

      display: none; /* 初期状態では非表示 */

      position: fixed; /* 画面に固定 */

      z-index: 1; /* 最前面に表示 */

      left: 0;

      top: 0;

      width: 100%;

      height: 100%;

      overflow: auto; /* コンテンツがはみ出したらスクロール */

      background-color: rgba(0,0,0,0.4); /* 半透明の背景 */

      justify-content: center;

      align-items: center;  

 z-index: 3

    }



    .modal-content {

      background-color: #fefefe;

      margin: auto;

      padding: 20px;

      border: 1px solid #888;

      border-radius: 10px;

      width: 80%;

      max-width: 500px; /* 最大幅 */

      box-shadow: 0 5px 15px rgba(0,0,0,0.3);

      position: relative;

    }



    .close-button {

      color: #aaa;

      float: right;

      font-size: 28px;

      font-weight: bold;

      position: absolute;

      top: 10px;

      right: 20px;

      cursor: pointer;

    }
    
    
    

    .close-button:hover,

    .close-button:focus {

      color: black;

      text-decoration: none;

    }



    .modal-content h2 {

      margin-top: 0;

      color: #333;

      text-align: center;

      margin-bottom: 20px;

    }



    /* QRデータ表示のみのスタイル */

    .modal-content .qr-display {

        font-weight: bold;

        color: #004d40;

        background-color: #f0f0f0;

        padding: 10px;

        border-radius: 5px;

        margin-bottom: 15px;

        text-align: center;

        word-break: break-all;

    }



    .modal-content label {

      display: block;

      margin-bottom: 5px;

      font-weight: bold;

      color: #555;

    }



    .modal-content input[type="text"],

    .modal-content textarea,

    .modal-content select { /* selectタグにもスタイルを適用 */

      width: calc(100% - 20px); /* 左右のパディングを考慮 */

      padding: 10px;

      margin-bottom: 15px;

      border: 1px solid #ccc;

      border-radius: 5px;

      font-size: 16px;

      box-sizing: border-box; /* パディングを幅に含める */

    }



    .modal-content textarea {

        resize: vertical;

        min-height: 100px;

    }



    .modal-content button {

      background-color: #007bff;

      color: white;

      padding: 10px 20px;

      border: none;

      border-radius: 5px;

      cursor: pointer;

      font-size: 16px;

      transition: background-color 0.3s ease;

      margin-right: 10px;

    }



    .modal-content button:hover {

      background-color: #0056b3;

    }



    .modal-content button.cancel {

        background-color: #6c757d;

    }

    .modal-content button.cancel:hover {

        background-color: #5a6268;

    }



    /* ポイント警告メッセージのスタイル */

    .point-warning {

        color: red;

        font-size: 0.9em;

        margin-top: -10px; /* 入力フィールドのすぐ下に表示 */

        margin-bottom: 10px;

    }

  </style>

</head>

<body>





 

    <div class="tile-grid" id="tileGrid"></div>

  </div>







  <div id="editModal" class="modal">

    <div class="modal-content">

      <span class="close-button">&times;</span>

      <h2>タイルを編集</h2>

      <form id="editForm">

        <label>QRデータ:</label>

        <div id="displayQrData" class="qr-display"></div>

        <input type="hidden" id="hiddenQrDataForUpdate">



        <label for="editPoint">ポイント:</label>

        <input type="text" id="editPoint" pattern="^-?\d*$" inputmode="numeric">

        <div id="pointWarning" class="point-warning" style="display: none;">※ポイントを消費します。</div>



        <label for="editDescription">説明:</label>

        <textarea id="editDescription"></textarea>



        <label for="editRank">ランク:</label>

        <select id="editRank">

            <option value="全員">全員</option>

            <option value="シルバー以上">シルバー以上</option>

            <option value="ゴールド以上">ゴールド以上</option>

            <option value="プラチナ以上">プラチナ以上</option>

            <option value="ダイヤモンド">ダイヤモンド</option>

        </select>

        <br>



        <label for="editReset">リセット:</label>

        <select id="editReset">

            <option value="true">ON</option>

            <option value="false">OFF</option>

        </select>

        <br><br>



        <button type="submit">保存</button>

        <button type="button" class="cancel" id="cancelEdit">キャンセル</button>

      </form>

    </div>







  <script>

    // GASのデータ取得用URL

    const SHEET_API_READ_URL = 'https://script.google.com/macros/s/AKfycbxU5x8GeGUVN8thh1R40kqsVMcLoSE6QtXew0bWllATW4qAupFt_cSmgp6Aa9lEBmIT/exec';

    // GASのデータ更新用URL (重要: これは新しいデプロイが必要です)

    const SHEET_API_UPDATE_URL = 'https://script.google.com/macros/s/AKfycbxNHdYH6u_pt0wunAkBOEuhTxOde-2i9UTnyXR6vMx_HTbnq9vBM4utWYxYdknWMRIt/exec'; // ★ここを実際の更新用GAS URLに置き換えてください★



    const tileGrid = document.getElementById('tileGrid');

    const editModal = document.getElementById('editModal');

    const closeButton = editModal.querySelector('.close-button');

    const editForm = document.getElementById('editForm');

    // const editRowIndex = document.getElementById('editRowIndex'); // rowIndexはもう不要なのでコメントアウト

    const displayQrData = document.getElementById('displayQrData');

    const hiddenQrDataForUpdate = document.getElementById('hiddenQrDataForUpdate'); // 新しく追加

    const editPoint = document.getElementById('editPoint');

    const pointWarning = document.getElementById('pointWarning');

    const editDescription = document.getElementById('editDescription');

    const editRank = document.getElementById('editRank');

    const editReset = document.getElementById('editReset');

    const cancelEditButton = document.getElementById('cancelEdit');



    let currentSheetData = []; // GASから取得した、フィルタリング済みの生データを保持



    // データの取得と表示

    function fetchAndRenderTiles() {

      fetch(SHEET_API_READ_URL)

        .then(response => response.json())

        .then(data => {

          currentSheetData = data; // データを保存

          renderTiles(data);

        })

        .catch(error => {

          console.error("データの取得に失敗しました:", error);

          alert("データの読み込みに失敗しました。ネットワーク接続を確認するか、GASのURLが正しいか確認してください。");

        });

    }



    // タイルの描画

    function renderTiles(sheetData) {

      tileGrid.innerHTML = ''; // 既存のタイルをクリア



      sheetData.forEach((row, index) => {

        const qrData = row[0];

        const resetValue = row[4]; 

        const displayReset = resetValue === true ? '✔️ON' : resetValue === false ? '❌OFF' : '未設定';



        if (qrData && String(qrData).trim() !== '') {

          const tile = document.createElement('div');

          tile.className = 'tile';

          // rowIndexはHTML側で編集モーダルを開く際にデータを探すためだけに使う

          tile.dataset.rowIndex = index; 



          // QRコード部分

          const qrDiv = document.createElement('div');

          qrDiv.className = 'tile-qrcode';

          const canvas = document.createElement('canvas');

          qrDiv.appendChild(canvas);

          tile.appendChild(qrDiv);



          QRCode.toCanvas(canvas, qrData, {

            width: 110,

            errorCorrectionLevel: 'H'

          }, (error) => {

            if (error) console.error("QRコード生成エラー:", qrData, error);

          });



          // 情報テキスト部分

          const tileInfo = document.createElement('div');

          tileInfo.className = 'tile-info';

          tileInfo.innerHTML = `

            <p class="main-text">QR: ${qrData}</p>

            <p>ポイント: ${row[1]}</p>

            <p>ランク: ${row[3]}</p>

            <p>リセット: ${displayReset}</p>

          `;







          tile.appendChild(tileInfo);



          tileGrid.appendChild(tile);



          // タイルクリックで編集モーダルを開く

          tile.addEventListener('click', () => {

            openEditModal(index); // HTMLのデータ配列インデックスを渡す

          });

        }

      });

    }



    // 編集モーダルを開く

    function openEditModal(rowIndex) {

      const rowData = currentSheetData[rowIndex]; // GASから受け取ったフィルタリング済みデータから取得

      if (!rowData) return;



      // HTMLの非表示フィールドにQRデータをセット (これをGASに送る)

      hiddenQrDataForUpdate.value = rowData[0] || '';

      displayQrData.textContent = rowData[0] || ''; // QRデータは表示のみ



      // ポイント

      const pointValue = rowData[1] === "" || rowData[1] === null ? "0" : String(rowData[1]);

      editPoint.value = pointValue;

      updatePointWarning(pointValue); // 警告メッセージの初期表示



      editDescription.value = rowData[2] || '';

      

      // ランクの選択

      const rankValue = rowData[3] || '全員';

      editRank.value = rankValue;



      // リセットの選択

      if (rowData[4] === true) {

          editReset.value = 'true';

      } else if (rowData[4] === false) {

          editReset.value = 'false';

      } else {

          editReset.value = 'false'; // デフォルトはOFF

      }



      editModal.style.display = 'flex'; // モーダルを表示

    }



    // 編集モーダルを閉じる

    closeButton.addEventListener('click', () => {

      editModal.style.display = 'none';

    });



    cancelEditButton.addEventListener('click', () => {

        editModal.style.display = 'none';

    });



    // モーダルの外側をクリックで閉じる

    window.addEventListener('click', (event) => {

      if (event.target === editModal) {

        editModal.style.display = 'none';

      }

    });



    // ポイント入力時のバリデーションと警告表示

    editPoint.addEventListener('input', (event) => {

        let value = event.target.value;

        // 数字、または先頭にマイナス記号のみを許可

        value = value.replace(/[^0-9-]/g, '');

        if (value.startsWith('-') && value.length > 1) {

            value = '-' + value.substring(1).replace(/-/g, '');

        } else if (!value.startsWith('-')) {

            value = value.replace(/-/g, '');

        }

        event.target.value = value;



        updatePointWarning(value);

    });



    function updatePointWarning(value) {

        const numValue = parseInt(value, 10);

        if (value.trim() !== '' && !isNaN(numValue) && numValue < 0) {

            pointWarning.style.display = 'block';

        } else {

            pointWarning.style.display = 'none';

        }

    }



    // フォーム送信（保存）時の処理

    editForm.addEventListener('submit', (event) => {

      event.preventDefault();



      const qrDataToUpdate = hiddenQrDataForUpdate.value; // GASに送るQRデータ



      // ポイントの値を数値に変換。空の場合は0とする

      let pointValue = editPoint.value.trim();

      if (pointValue === '') {

          pointValue = 0;

      } else {

          pointValue = parseInt(pointValue, 10);

          if (isNaN(pointValue)) {

              alert("ポイントは数字で入力してください。");

              return;

          }

      }

      

      // リセットの値（ブール値に変換）

      const resetValue = editReset.value === 'true';



      // 更新データはQRデータを含めて構築（GAS側でQRデータを使って検索するため）

