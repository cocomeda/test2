<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>CoCoめだか</title>
    <link rel="stylesheet" href="css/style_4kfm.css">
    <script src="https://static.line-scdn.net/liff/edge/versions/2.14.0/sdk.js"></script>
    <style>
          body {
            font-family: Arial, sans-serif;
            text-align: center;
            margin: 0;
            padding: 0;
        }
        .button-container {
            display: flex;
            justify-content: space-between; /* ボタンを横に均等に並べる */
            padding: 1vw; /* コンテナ内の余白 */
            box-sizing: border-box; /* パディングを幅に含める */
        }
        .img-button {
            width: 30vw; /* ビューポート幅の30% */
            height: 30vw; /* 高さは自動調整 */
            border: none;
            border-radius: 2vw;
            cursor: pointer;
            transition: opacity 0.3s ease;
        }
        .img-button:hover {
            opacity: 0.8;
        }
        a {
            display: block;
            text-decoration: none;
        }
    </style>
</head>
<body>
    <h1>CoCoめだか</h1>

    
<pa><div id="data-container3">-</div></pa>
<pb><div id="data-container2">now loading...</div></pb>
<pa1><div class="vertical-progress-bar">
  <div id="progressBar_vertical" class="vertical-progress-bar-inner" style="height:0%;"></div>
</div></pa1>	
</div>
	
  <div style="width: 100%; border: 0.2vw solid #ccc;">
    <div id="progressBar" style="width: 0%; height: 0.3vw; background-color: #7cfc00;"></div>
  </div>
	

    
      <div class="button-container">
<a href="QRCR_r.html"><img src="QRCR_r1.jpg" class="img-button" alt="QRコードリーダー"></a>
<a href="numberForm.html"><img src="4kfm1.jpg" class="img-button" alt="コード入力フォーム"></a>
<a href="reservation.html"><img src="RSVT1.jpg" class="img-button" alt="予約注文"></a>
      </div>  





    
    <script>
        document.addEventListener('DOMContentLoaded', () => {
            liff.init({ liffId: "1657196041-ALeOLrEa" }, () => {

 　　　　　　　sendIdTokenToGAS();
                
                document.getElementById('openNumberForm').addEventListener('click', () => {
                    liff.openWindow({
                        url: 'QRCR_r.html',
                        external: true
                    });
                });

                document.getElementById('anotherAction').addEventListener('click', () => {
                    liff.openWindow({
                        url: 'numberForm.html',
                        external: true
                    });
                });

                document.getElementById('thirdAction').addEventListener('click', () => {
                      liff.openWindow({
                        url: 'reservation.html',
                        external: true
                    });
                });
            }, err => {
                console.error('LIFF初期化エラー:', err);
            });
        });









        


        // IDトークンをGASに送信する関数
        function sendIdTokenToGAS() {
            const idToken = liff.getIDToken();

            // ローディング画像表示
            $('#loading').show();

            // IDトークンをGASに送信
            $.ajax({
                url: 'https://script.google.com/macros/s/AKfycbz4I7jwbEU7UFqtoFQnCzVqKtG5xA9dBUw0s-jR8aBxbZ5LzIF8ISLXU7czUhVPYTBnjQ/exec',
                type: 'POST',
                data: { idToken: idToken },
                success: function (response) {
                    // 成功時
                    console.log(response);
                    displayData(response);
                },
                error: function (error) {
                    // エラー時
                    console.error(error);
                    alert('Failed to send ID Token to GAS.');
                },
                complete: function () {
                    // 通信完了時の処理（ローディング画像を非表示にし、コンテンツを表示）
                    $('#loading').hide();
                    $('#content').show();
                }
            });
        }
  
 // メッセージを表示する関数
    function displayMessage(message) {
        const messageElement = document.createElement('p');
        messageElement.textContent = message;
        document.body.appendChild(messageElement);
    }

    // 取得したデータをHTMLに表示する関数
    function displayData(data) {
        const jsonData = JSON.parse(data);


   const progressBar0 = document.getElementById('progressBar_vertical');
   // progressBar0.textContent = `あと${jsonData.nextRank} pt `; 
  progressBar0.style.height = `${jsonData.progress_rate*100}`+'%';
 //progressBar0.style.height = "10"+"vw";



  // const progressBar = document.getElementById('progressBar');
   // progressBar.textCont//ent = `${jsonData.score} `; 
 // progressBar.style.width = `${jsonData.progress_rate*100}`+'vw';
 //progressBar.style.height = "10"+"vw";



        const container2 = document.getElementById("data-container2");
        const container3 = document.getElementById("data-container3");
        const container4 = document.getElementById("data-container4");

        const paragraph2 = document.createElement("p_pt");
        paragraph2.textContent =`${jsonData.score}℗ `;　// pt
　　　　container2.textContent = ""; // 既存のコンテンツをクリア
        container2.appendChild(paragraph2);

        const paragraph3 = document.createElement("p_rank");
        paragraph3.textContent = `${jsonData.rank} `;　//rank
　　　　container3.textContent = ""; // 既存のコンテンツをクリア
        container3.appendChild(paragraph3);
        document.querySelector("pa").style.border = "1vw double gray";
	    
  document.querySelector(".vertical-progress-bar").style.border = "0.2vw solid gray";



  if (jsonData.rank === "レギュラー") {
      document.querySelector("pa").style.backgroundColor = "#f5deb3";
    } else if (jsonData.rank === "シルバー") {
      document.querySelector("pa").style.backgroundColor = "#f5f5f5";
    } else if (jsonData.rank === "ゴールド") {
      document.querySelector("pa").style.backgroundColor = "#f0e68c";
    } else if (jsonData.rank === "プラチナ") {
      document.querySelector("pa").style.backgroundColor = "#add8e6";
    } else if (jsonData.rank === "ダイヤモンド") {
      document.querySelector("pa").style.backgroundColor = "#1e90ff";
    } else {
      // その他の場合のデフォルトの背景色を設定
      document.querySelector("pa").style.backgroundColor = "#f5f5dc";
    }

    }








        
    </script>
</body>
</html>
