


<button id="btn">認証＆送信</button>
<pre id="result"></pre>

<script src="https://static.line-scdn.net/liff/edge/2/sdk.js"></script>
<script>
  const LIFF_ID = '1657196041-ALeOLrEa';
  const VERIFY_URL = 'https://us-central1-coco-auction.cloudfunctions.net/verifyLineTokenAndSignIn2';

  document.getElementById('btn').onclick = async () => {
    const result = document.getElementById('result');
    try {
      await liff.init({ liffId: LIFF_ID });
      if (!liff.isLoggedIn()) {
        liff.login();
        return;
      }
      const idToken = await liff.getIDToken();
      result.textContent = 'IDトークン取得成功\n送信中...';

      const res = await fetch(VERIFY_URL, {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ idToken })
      });

      if (!res.ok) {
        const text = await res.text();
        result.textContent = `エラー: ${res.status}\n${text}`;
        return;
      }

      const json = await res.json();
      result.textContent = `成功！\nFirebaseトークン:\n${json.firebaseToken}`;
    } catch (e) {
      result.textContent = `例外エラー: ${e.message}`;
    }
  };
</script>










