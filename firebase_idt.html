<!DOCTYPE html>  
<html>  
<head>  
  <meta charset="UTF-8">  
  <title>LIFF IDãƒˆãƒ¼ã‚¯ãƒ³ç¢ºèª</title>  
  <script src="https://static.line-scdn.net/liff/edge/2/sdk.js"></script>  
</head>  
<body>  
  <h2>LIFF â†’ verifyLineTokenAndSignIn2 ãƒ†ã‚¹ãƒˆ</h2>  
  <button id="run-test">èªè¨¼ï¼†ãƒ†ã‚¹ãƒˆå®Ÿè¡Œ</button>  
  <pre id="result" style="white-space:pre-wrap;"></pre>  
  
  <script>  
  
    const LIFF_ID = "1657196041-ALeOLrEa"; // â† ã‚ãªãŸã®LIFF IDã«å¤‰æ›´æ¸ˆã¿  
    const VERIFY_URL = "https://us-central1-coco-auction.cloudfunctions.net/verifyLineTokenAndSignIn2"; 
    
  window.addEventListener('load', async () => {
      const output = document.getElementById('result');  
      output.textContent = "åˆæœŸåŒ–ä¸­...";  
  
      try {  
        await liff.init({ liffId: LIFF_ID });  
  
        if (!liff.isLoggedIn()) {  
          output.textContent = "ãƒ­ã‚°ã‚¤ãƒ³ã—ã¾ã™...";  
          liff.login();  
          return;  
        }  
  
        const idToken = await liff.getIDToken();  
  
alert(idToken)  
          
        output.textContent = "IDãƒˆãƒ¼ã‚¯ãƒ³å–å¾—æˆåŠŸã€‚\né€ä¿¡ä¸­...";  
  
        const res = await fetch(VERIFY_URL, {  
          method: 'POST',  
          headers: { 'Content-Type': 'application/json' },  
          body: JSON.stringify({ idToken })  
        });  
  
        if (!res.ok) {  
          const text = await res.text();  
          output.textContent = `âŒ ã‚¨ãƒ©ãƒ¼ (status ${res.status}):\n${text}`;  
          return;  
        }  
  
        const json = await res.json();  
        output.textContent = `âœ… æˆåŠŸ:\nFirebase Token:\n${json.firebaseToken}`;  
      } catch (err) {  
        output.textContent = `ğŸš« å®Ÿè¡Œä¸­ã‚¨ãƒ©ãƒ¼:\n${err}`;  
        console.error(err);  
      }  
    });  
  </script>  
</body>  
</html>
